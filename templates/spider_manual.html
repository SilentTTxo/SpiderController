<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<head>
    <link rel="stylesheet" type="text/css" href="/media/css/TT.css" />
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->

<body class="page-header-fixed">
    <div class="loader">
        <div class="loading-1"></div>
        <div class="loading-2">Loading...</div>
    </div>
    <!-- BEGIN HEADER -->
    <div class="header navbar navbar-inverse navbar-fixed-top">
        <!-- BEGIN TOP NAVIGATION BAR -->
        <div class="navbar-inner">
            <div class="container-fluid">
                <!-- BEGIN LOGO -->
                <a class="brand" href="index.html">
                    <img src="/media/image/logo.png" alt="logo" />
                </a>
                <!-- END LOGO -->
                <!-- BEGIN RESPONSIVE MENU TOGGLER -->
                <a href="javascript:;" class="btn-navbar collapsed" data-toggle="collapse" data-target=".nav-collapse">
                    <img src="/media/image/menu-toggler.png" alt="" />
                </a>
                <!-- END RESPONSIVE MENU TOGGLER -->
                <!-- BEGIN TOP NAVIGATION MENU -->
                <ul class="nav pull-right">

                </ul>
                <!-- END TOP NAVIGATION MENU -->
            </div>
        </div>
        <!-- END TOP NAVIGATION BAR -->
    </div>
    <!-- END HEADER -->
    <!-- BEGIN CONTAINER -->
    <div class="page-container row-fluid">
        <!-- BEGIN SIDEBAR -->
        <div class="page-sidebar nav-collapse collapse">
            <!-- BEGIN SIDEBAR MENU -->
            <ul class="page-sidebar-menu">
            </ul>
            <!-- END SIDEBAR MENU -->
        </div>
        <!-- END SIDEBAR -->
        <!-- BEGIN PAGE -->
        <div class="page-content">
            <!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
            <div id="portlet-config" class="modal hide">
                <div class="modal-header">
                    <button data-dismiss="modal" class="close" type="button"></button>
                    <h3>portlet Settings</h3>
                </div>
                <div class="modal-body">
                    <p>Here will be a configuration form</p>
                </div>
            </div>
            <!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
            <!-- BEGIN PAGE CONTAINER-->
            <div class="container-fluid">
                <style type="text/css">
                </style>
                <!-- BEGIN PAGE HEADER-->
                <div class="row-fluid">
                    <div class="span12" id="pageinfo">
                    </div>
                </div>
                <!-- END PAGE HEADER-->
                <!-- BEGIN PAGE CONTENT-->
                <div class="row-fluid">
                    <div class="span12 dataContent">
                        <div class="span12">

                            <div class="portlet box grey">
                                <div class="portlet-title">
                                    <div class="caption"><i class="icon-reorder"></i>手动模式</div>
                                </div>
                                <div class="portlet-body">
                                    <p style="display: inline;">选择爬虫：</p>
                                    <select class="form-control" style="margin-bottom: 0px;" id="selectSpider">
                                    </select>
                                    <p style="display: inline;">选择文件：</p>
                                    <select class="form-control" style="margin-bottom: 0px;" id="selectType">
                                        <option value=1>spider.py</option>
                                        <option value=2>pipelines.py</option>
                                        <option value=3>items.py</option>
                                        <option value=4>settings.py</option>
                                    </select>
                                    <button class="btn green" id="getFile">获取 <i class="m-icon-swapright m-icon-white"></i></button>
                                    <button class="btn red" id="saveFile">保存 <i class="m-icon-swapright m-icon-white"></i></button>

                                    <hr>
                                    <textarea id="datacontent" style="width: 99%;height: 600px;" spellcheck="false"></textarea>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <!-- END PAGE CONTENT-->
            </div>
            <!-- END PAGE CONTAINER-->
        </div>
        <!-- END PAGE -->
    </div>
    <!-- END CONTAINER -->
    <!-- BEGIN FOOTER -->
    <div class="footer">
    </div>
    <!-- END FOOTER -->
    <!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
    <!-- BEGIN CORE PLUGINS -->

    <script src="/media/js/jquery-1.10.1.min.js" type="text/javascript"></script>
    <script src="/media/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
    <!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
    <script src="/media/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
    <script src="/media/js/bootstrap.min.js" type="text/javascript"></script>
    <!--[if lt IE 9]>
	<script src="/media/js/excanvas.min.js"></script>
	<script src="/media/js/respond.min.js"></script>  
	<![endif]-->
    <script src="/media/js/jquery.slimscroll.min.js" type="text/javascript"></script>
    <script src="/media/js/jquery.blockui.min.js" type="text/javascript"></script>
    <script src="/media/js/jquery.cookie.min.js" type="text/javascript"></script>
    <script src="/media/js/jquery.uniform.min.js" type="text/javascript"></script>
    <!-- END CORE PLUGINS -->
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <script src="/media/js/jquery.vmap.js" type="text/javascript"></script>
    <script src="/media/js/jquery.vmap.russia.js" type="text/javascript"></script>
    <script src="/media/js/jquery.vmap.world.js" type="text/javascript"></script>
    <script src="/media/js/jquery.vmap.europe.js" type="text/javascript"></script>
    <script src="/media/js/jquery.vmap.germany.js" type="text/javascript"></script>
    <script src="/media/js/jquery.vmap.usa.js" type="text/javascript"></script>
    <script src="/media/js/jquery.vmap.sampledata.js" type="text/javascript"></script>
    <script src="/media/js/jquery.flot.js" type="text/javascript"></script>
    <script src="/media/js/jquery.flot.resize.js" type="text/javascript"></script>
    <script src="/media/js/jquery.pulsate.min.js" type="text/javascript"></script>
    <script src="/media/js/jquery.flot.pie.js"></script>
    <script src="/media/js/jquery.flot.stack.js"></script>
    <script src="/media/js/jquery.flot.crosshair.js"></script>

    <script src="/media/js/date.js" type="text/javascript"></script>
    <script src="/media/js/daterangepicker.js" type="text/javascript"></script>
    <script src="/media/js/jquery.gritter.js" type="text/javascript"></script>
    <script src="/media/js/fullcalendar.min.js" type="text/javascript"></script>
    <script src="/media/js/app.js"></script>
    <script src="//cdn.bootcss.com/Chart.js/1.1.0/Chart.js"></script>

    <script src="/media/js/TT.js"></script>

    <script>
        var myInput = document.getElementById("datacontent");
        str = "\t";
        if (myInput.addEventListener) {
            myInput.addEventListener('keydown', this.keyHandler, false);
        } else if (myInput.attachEvent) {
            myInput.attachEvent('onkeydown', this.keyHandler); /* damn IE hack */
        }

        function keyHandler(e) {
            var TABKEY = 9;
            if (e.keyCode == TABKEY) {
                insertText(myInput, str);
                if (e.preventDefault) {
                    e.preventDefault();
                }
            }
        }

        function insertText(obj, str) {
            if (document.selection) {
                var sel = document.selection.createRange();
                sel.text = str;
            } else if (typeof obj.selectionStart === 'number' && typeof obj.selectionEnd === 'number') {
                var startPos = obj.selectionStart,
                    endPos = obj.selectionEnd,
                    cursorPos = startPos,
                    tmpStr = obj.value;
                obj.value = tmpStr.substring(0, startPos) + str + tmpStr.substring(endPos, tmpStr.length);
                cursorPos += str.length;
                obj.selectionStart = obj.selectionEnd = cursorPos;
            } else {
                obj.value += str;
            }
        }


        addDataItem = function (item) {
            data = '<option value={sid}>{name}</option>'.format(item)
            $("#selectSpider").append(data)

        }
        getSpiderInfo = function () {
            $("#selectSpider").empty()
            $.ajax({
                type: "GET",
                url: "/api/getSpiderInfo",
                success: function (result) {
                    result = jQuery.parseJSON(result);
                    for (i in result.data) {
                        addDataItem(result.data[i])
                    }
                }
            })
        }
        flush = function () {}
        jQuery(document).ready(function () {

            App.init();
            TT.init();

            getSpiderInfo()
            $("#getFile").click(function () {
                $.ajax({
                    type: "GET",
                    url: "/api/getSpiderFile?sid=" + $("#selectSpider").val() + "&type=" + $(
                        "#selectType").val(),
                    success: function (result) {
                        result = jQuery.parseJSON(result);
                        $("#datacontent").empty()
                        $("#datacontent").val(result.file)
                    }
                })
            })


            $("#saveFile").click(function(){
                data = {"sid": + $("#selectSpider").val(),"type":$("#selectType").val(),"content":$("#datacontent").val()}
                $.ajax({
                    type: "POST",
                    url: "/api/setSpiderFile",
                    data:data,
                    success: function (result) {
                        result = jQuery.parseJSON(result);
                        if(result.code == "1"){
                            showMsg("保存成功")
                        }
                    },
                    error:function(){
                        showMsg("保存失败")
                    }
                })
            })
        });
    </script>
    <!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->

</html>